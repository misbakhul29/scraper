<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Scraper API Documentation</title>
  <style>
    body { font-family: Inter, Roboto, system-ui, Arial, sans-serif; line-height: 1.6; background:#f7fafc; color:#0f172a; padding:32px; }
    .container { max-width:960px; margin:0 auto; background:#fff; padding:24px; border-radius:8px; box-shadow:0 8px 24px rgba(15,23,42,0.06); }
    h1 { margin-top:0; }
    pre { background:#0f172a; color:#f8fafc; padding:12px; border-radius:6px; overflow:auto }
    code { padding:2px 6px; border-radius:4px }
    dl dt { font-weight:600; margin-top:16px }
    .badge { display:inline-block; background:#e6f7ff; color:#0369a1; padding:6px 8px; border-radius:6px; font-size:13px }
    .note { background:#fff7ed; border-left:4px solid #fb923c; padding:8px 12px; margin:12px 0; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Scraper API Documentation</h1>
    <p class="badge">Payload limit: 100kb • Generation rate limit: 5 req / 60s</p>

    <section>
      <h2>Overview</h2>
      <p>This service queues article generation jobs and processes them using a ChatGPT-based scraper.</p>
      <p>Responses are JSON and incoming payloads are sanitized to remove scripts and dangerous HTML fragments.</p>
    </section>

    <section>
      <h2>Endpoints</h2>

      <h3>POST /api/articles/generate</h3>
      <p>Public endpoint that queues generation and optionally notifies your webhook when done.</p>
      <pre><code>curl -X POST http://localhost:3000/api/articles/generate \
  -H "Content-Type: application/json" \
  -d '{"topic":"My topic","webhookUrl":"https://example.com/webhook","webhookSecret":"s3cr3t"}'</code></pre>
      <p>Webhook receives a JSON POST: <code>{ success: true, jobId, data }</code> and a header <code>X-Webhook-Signature</code> when a secret is provided.</p>

      <h3>GET /api/articles/queue/status</h3>
      <p>Queue status (messageCount, consumerCount).</p>
    </section>

    <section>
      <h2>Security Notes</h2>
      <div class="note">
        <strong>Sanitization:</strong> All incoming string fields are sanitized to remove obvious XSS vectors (scripts, inline event handlers, javascript: URIs).
      </div>
    </section>

    <section>
      <h2>IP Whitelist & Blacklist</h2>
      <p>The public generation endpoint <code>/api/articles/generate-public</code> is protected by an IP access control list.</p>
      <ul>
        <li><strong>POST /api/ip/request</strong> — Request whitelist for your IP. Body: <code>{ ip?: string, note?: string }</code>. If <code>ip</code> is omitted, your request IP will be used. New requests are created with status <code>PENDING</code> (waiting approval).</li>
        <li><strong>GET /api/ip</strong> — Admin: list IP requests (requires <code>X-Admin-Key</code> header set to <code>ADMIN_API_KEY</code>).</li>
        <li><strong>PATCH /api/ip/:id/status</strong> — Admin: update IP status to <code>PENDING</code>/<code>WHITELIST</code>/<code>BLACKLIST</code> (requires <code>X-Admin-Key</code>).</li>
      </ul>
      <p>Behavior when hitting protected routes:</p>
      <ul>
        <li><strong>WHITELIST</strong> — Request proceeds normally.</li>
        <li><strong>PENDING</strong> — Returns <code>403</code> with message <em>Your IP is waiting approval</em> (or asks to POST /api/ip/request if no record exists).</li>
        <li><strong>BLACKLIST</strong> — Returns <code>403</code> with a friendly quote ("kata-kata mutiara").</li>
      </ul>
    </section>

    <section>
        <h2>Support</h2>
        <p>Jika ada pertanyaan mengenai scraper, silakan kirim email ke: <a href="mailto:misbakhul2904@gmail.com">misbakhul2904@gmail.com</a> atau lewat Facebook: <a href="https://www.facebook.com/Misbakhul29" target="_blank" rel="noopener noreferrer">facebook.com/Misbakhul29</a></p>
    </section>

    <footer style="margin-top:20px; font-size:13px; color:#64748b">
      <div>Generated by Scraper</div>
    </footer>
  </div>
</body>
</html>